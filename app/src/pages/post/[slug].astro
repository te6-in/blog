---
import { getCollection, render } from "astro:content";
import Prose from "../../components/Prose.astro";
import AnchorWithLinkPreview from "../../components/mdx/AnchorWithLinkPreview.astro";
import BaselineStatus from "../../components/mdx/BaselineStatus.astro";
import Bluesky from "../../components/mdx/Bluesky.astro";
import Callout from "../../components/mdx/Callout.astro";
import Foo from "../../components/mdx/Foo.astro";
import Hr from "../../components/mdx/Hr.astro";
import Image from "../../components/mdx/Image.astro";
import Link from "../../components/mdx/Link.astro";
import Twitter from "../../components/mdx/Twitter.astro";
import YouTube from "../../components/mdx/YouTube.astro";
import Layout from "../../layouts/Layout.astro";

export async function getStaticPaths() {
  const posts = await getCollection("post");

  return posts.map((post) => ({
    params: { slug: post.id },
    props: { post },
  }));
}

const { post } = Astro.props;
const { Content } = await render(post);
---
<Layout>
  {post.data.coverImage && <Image src={post.data.coverImage} />}
  <Prose>
    <Content
      components={{
        Callout,
        Link,
        AppleMusic: Foo,
        Twitter,
        YouTube,
        Bluesky,
        BaselineStatus,
        ImageGrid: Foo,
        img: Image,
        a: AnchorWithLinkPreview,
        hr: Hr,
      }}
    />
  </Prose>
</Layout>
