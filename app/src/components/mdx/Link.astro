---
// biome-ignore lint/style/useImportType: <explanation>
import { LinkPreview } from "astro-embed";
import type { ComponentProps } from "astro/types";
import { getAnchor } from "./get-anchor";

interface LinkPreviewProps extends ComponentProps<typeof LinkPreview> {}

interface Props extends Pick<LinkPreviewProps, "hideMedia"> {
  href: LinkPreviewProps["id"];
}

const { href, ...props } = Astro.props;

const { url, type, detail } = await getAnchor({ href, astroURL: Astro.url });

const linkPreviewProps: LinkPreviewProps = {
  id: url.href,
  ...props,
  ...(type !== "hash" && {
    target: "_blank",
    rel: "noopener noreferrer",
  }),
};
---
<LinkPreview {...linkPreviewProps} />
