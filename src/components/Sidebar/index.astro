---
import { FileCode2, Newspaper, Tags } from "lucide-astro";
import { getTags } from "../../lib/contents";
import { Collapsible } from "../Collapsible";
import LinkSidebarItem from "./LinkSidebarItem.astro";
import TagChip from "../TagChip.astro";

interface Props {
  currentPage?: { type: "posts" | "snippets" } | { type: "tags"; slug: string };
}

const { currentPage } = Astro.props;

const tags = await getTags({ sortBy: "count" });
---

<aside
  id="sidebar"
  class="fixed inset-y-0 -start-sidebar-width sidebar-shown:start-0 stretch:ms-sidebar-stretch-x pt-marginal-height transition-[inset] w-sidebar-width overflow-x-hidden overscroll-y-none [scrollbar-color:var(--color-neutral-300)_transparent]"
>
  <div
    class="sticky top-0 inset-x-0 h-22 -mx-2 bg-gradient-to-b from-body-bg to-transparent pointer-events-none z-10"
  >
  </div>
  <nav class="flex flex-col gap-2 w-[inherit] px-sidebar-padding-x py-4 -mt-22">
    <LinkSidebarItem to="/posts" isCurrentPage={currentPage?.type === "posts"}>
      <Newspaper slot="icon" />
      <Fragment slot="title">글</Fragment>
    </LinkSidebarItem>
    <LinkSidebarItem
      to="/snippets"
      isCurrentPage={currentPage?.type === "snippets"}
    >
      <FileCode2 slot="icon" />
      <Fragment slot="title">코드 조각</Fragment>
    </LinkSidebarItem>
    <Collapsible
      client:load
      defaultOpen={currentPage?.type === "tags"}
      classNames={{
        root: "flex flex-col -mx-2 justify-start",
        triggerRoot:
          "flex items-center justify-between gap-1 rounded-lg p-2 engaged:bg-black/5 backdrop-blur-none engaged:backdrop-blur-sm transition-all z-10 cursor-pointer text-neutral-700 sticky top-2",
        triggerContent: "flex items-center gap-2",
        triggerChevron: "transition-transform flex-none",
        triggerTitle: "font-semibold",
        panelContent: "flex gap-3 mt-1",
      }}
    >
      <Tags slot="triggerIcon" />
      <Fragment slot="triggerTitle">태그</Fragment>
      <Fragment slot="panelContent">
        <div class="w-0.5 rounded-full bg-neutral-200 ms-4.5 flex-none"></div>
        <ul role="list" class="flex flex-wrap gap-1.5 py-1.5">
          {
            tags.map((tag) => (
              <li>
                <TagChip
                  {...tag}
                  isCurrentPage={
                    currentPage?.type === "tags" &&
                    currentPage?.slug === tag.slug
                  }
                />
              </li>
            ))
          }
        </ul>
      </Fragment>
    </Collapsible>
  </nav>
</aside>
