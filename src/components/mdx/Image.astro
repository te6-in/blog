---
// biome-ignore lint/style/useImportType: limited support of biome for astro files
import { Image as AstroImage, getImage } from "astro:assets";
import { getCollection } from "astro:content";
import { removeQueryString } from "@astrojs/internal-helpers/path";
import type { ComponentProps } from "astro/types";

type Props = ComponentProps<typeof AstroImage>;

const image = await getImage({ src: Astro.props.src });
const decodedSrc = decodeURIComponent(image.src);

const fileName = removeQueryString(decodedSrc).split("/").pop();

const alt =
  Astro.props.alt ||
  (await getCollection("altTexts")).find(({ id }) => id === fileName?.split(".")[0])?.data;

if (!alt) throw new Error(`Alt text not found or empty. src: ${decodedSrc}`);
---
<AstroImage {...Astro.props} alt={alt} />
