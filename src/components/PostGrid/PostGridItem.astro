---
import Link from "astro-typesafe-routes/link";
import { shuffle } from "es-toolkit";
import { Beer, Candy, Pizza, Popcorn, Sandwich } from "lucide-astro";
import ImageWithInferredAlt from "../ImageWithInferredAlt.astro";
import type { ComponentProps, HTMLAttributes } from "astro/types";
import { Image } from "astro:assets";

interface Props extends HTMLAttributes<"a"> {
  slug: string;
  title: string;
  description: string;
  coverImage?: ComponentProps<typeof Image>["src"];
}

const {
  slug,
  title,
  description,
  coverImage,
  class: className,
  ...props
} = Astro.props;
---

<Link
  to="/post/[slug]"
  params={{ slug }}
  class:list={[
    "flex flex-col gap-3.5 engaged:bg-gray-100 p-2.5 sidebar-shown:p-3.5 rounded-2xl transition-all group dark:engaged:bg-zinc-900",
    className,
  ]}
  {...props}
>
  {
    coverImage ? (
      <div class="rounded-lg overflow-hidden media-border after:rounded-lg">
        <ImageWithInferredAlt
          src={coverImage}
          class="not-noscript:motion-safe:animate-pulse bg-gray-400 dark:bg-zinc-600 motion-safe:group-engaged:scale-105 transition-transform"
          onload="this.classList.remove('not-noscript:motion-safe:animate-pulse')"
        />
      </div>
    ) : (
      <div
        aria-hidden
        class="rounded-lg bg-gray-50 dark:bg-zinc-950 media-border after:rounded-lg aspect-16/10 text-gray-300 dark:text-zinc-700 flex justify-center items-center [&>svg]:size-1/4"
      >
        {
          shuffle([
            <Sandwich />,
            <Candy />,
            <Pizza />,
            <Popcorn />,
            <Beer />,
          ])[0]
        }
      </div>
    )
  }
  <div class="text-balance flex flex-col gap-1.5 p-0.5">
    <div
      class="text-xl text-gray-800 dark:text-zinc-200 leading-snug font-semibold"
    >
      {title}
    </div>
    <p class="text-sm text-gray-500 dark:text-zinc-500 leading-snug">
      {description}
    </p>
  </div>
</Link>
