---
import { getCollection } from "astro:content";
import PrevNextNavigationItem from "./PrevNextNavigationItem.astro";
import Link from "astro-typesafe-routes/link";
import { FileCode2, Newspaper } from "lucide-astro";
import PrevNextNavigationEmptyItem from "./PrevNextNavigationEmptyItem.astro";

interface Props {
  navigateIn: "post" | "snippet";
  currentSlug: string;
}

const { navigateIn, currentSlug } = Astro.props;

const posts = (await getCollection(navigateIn)).sort(
  (a, b) =>
    new Date(a.data.publishedAt).getTime() -
    new Date(b.data.publishedAt).getTime()
);

const currentPostIndex = posts.findIndex((post) => post.id === currentSlug);

const previousPost = posts[currentPostIndex - 1];
const nextPost = posts[currentPostIndex + 1];
---

<div class="flex flex-col gap-6 items-center">
  <nav
    class="grid grid-rows-2 lg:grid-rows-[unset] lg:grid-cols-2 gap-1.5 w-full"
  >
    {
      previousPost ? (
        <PrevNextNavigationItem
          type={navigateIn}
          direction="previous"
          title={previousPost.data.title}
          slug={previousPost.id}
          imageSrc={
            previousPost.collection === "post"
              ? previousPost.data.coverImage
              : undefined
          }
        />
      ) : (
        <PrevNextNavigationEmptyItem direction="previous" />
      )
    }
    {
      nextPost ? (
        <PrevNextNavigationItem
          type={navigateIn}
          direction="next"
          title={nextPost.data.title}
          slug={nextPost.id}
          imageSrc={
            nextPost.collection === "post"
              ? nextPost.data.coverImage
              : undefined
          }
        />
      ) : (
        <PrevNextNavigationEmptyItem direction="next" />
      )
    }
  </nav>
  {
    navigateIn === "post" && (
      <Link
        to="/posts"
        class="flex gap-1.5 px-4 py-3 rounded-full bg-neutral-50 border border-neutral-200 items-center text-sm text-neutral-700 font-semibold engaged:bg-neutral-100 transition-colors shadow-xs"
      >
        <Newspaper size={18} />
        <span>모든 글 보기</span>
      </Link>
    )
  }
  {
    navigateIn === "snippet" && (
      <Link
        to="/snippets"
        class="flex gap-1.5 px-4 py-3 rounded-full bg-neutral-50 border border-neutral-200 items-center text-sm text-neutral-700 font-semibold engaged:bg-neutral-100 transition-colors shadow-xs"
      >
        <FileCode2 size={18} />
        <span>모든 코드 조각 보기</span>
      </Link>
    )
  }
</div>
